(this["webpackJsonpava-frontend"]=this["webpackJsonpava-frontend"]||[]).push([[0],{37:function(t,e,n){t.exports=n(80)},42:function(t,e,n){},79:function(t,e,n){},80:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),r=n(13),c=n.n(r),s=(n(42),n(2)),i=n.n(s),l=n(4),u=n(7),p=n(8),h=n(10),d=n(9),m=n(17),v=function(t){Object(h.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this)).state={props:t},a}return Object(p.a)(n,[{key:"backendRenamer",value:function(){var t=Object(l.a)(i.a.mark((function t(e,n){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=JSON.stringify({file:e,newName:n}),t.next=3,fetch("https://ava-backend.herokuapp.com/conversations",{headers:{Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:a,method:"PUT"});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"handleKeyPress",value:function(t){13===t.charCode&&(t.preventDefault(),this.frontendRenamer(t))}},{key:"frontendRenamer",value:function(t){if(""===t.target.value)return console.log("no input");var e=Object(m.a)(this.props.conversations).filter((function(e){return e.id===t.target.placeholder}));return t.target.placeholder=t.target.value,this.backendRenamer(e,t.target.value),e[0].id=t.target.placeholder,t.target.value=""}},{key:"conversationDeleter",value:function(t){var e=Object(m.a)(this.props.conversations),n=e.filter((function(e){return e.id===t})),a=e.indexOf(n[0]);this.props.conversations.splice(a,1),this.setState({conversations:this.props.conversations})}},{key:"clickStopper",value:function(t){t.stopPropagation()}},{key:"buttonClick",value:function(){var t=Object(l.a)(i.a.mark((function t(e){var n,a,o,r,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.stopPropagation(),"delete"!==e.target.id){t.next=10;break}return n=e.target.parentElement.parentElement.firstChild.firstChild[0].placeholder,a=JSON.stringify({file:n}),this.conversationDeleter(n),t.next=7,fetch("https://ava-backend.herokuapp.com/conversations",{headers:{Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:a,method:"DELETE"});case 7:return t.abrupt("return",t.sent);case 10:if("new"!==e.target.id){t.next=20;break}return o="NewConversation"+Date.now(),console.log(o),this.setState({conversations:this.props.conversations.push({id:o})}),r=JSON.stringify({file:o}),t.next=17,fetch("https://ava-backend.herokuapp.com/conversations",{headers:{Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:r,method:"POST"});case 17:return t.abrupt("return",t.sent);case 20:return c=e.target.parentElement.parentElement.firstChild.firstChild[0].placeholder,t.abrupt("return",this.props.starToggler(c));case 22:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"rowClick",value:function(t){var e=t.target.firstChild.firstChild.firstChild.placeholder;return this.props.onRouteChange(e)}},{key:"openUp",value:function(t){var e=t.target.parentElement.parentElement.firstChild.firstChild.firstChild.placeholder;return this.props.onRouteChange(e)}},{key:"render",value:function(){var t,e=this,n=this.props.conversations;return o.a.createElement("div",{className:"container conv-list-container"},o.a.createElement("div",{className:"row conv-list-ops-row"},o.a.createElement("div",{className:"column conv-list-ops-column"},o.a.createElement("button",{onClick:function(t){e.buttonClick(t)},id:"new",className:"new-button"},"New+"))),o.a.createElement("div",{className:"column conv-list-column"},n.map((function(n,a){return t=localStorage.getItem("".concat(n.id,"-star"))?localStorage.getItem("".concat(n.id,"-star")):"star.svg",o.a.createElement("div",{className:"row conv-list-row",key:"".concat(a),onClick:function(t){return e.rowClick(t)}},o.a.createElement("div",{className:"column conv-title-column",onClick:function(t){e.clickStopper(t)}},o.a.createElement("form",{onSubmit:e.handleSubmit},o.a.createElement("input",{id:"conversation-titles",maxLength:"30",placeholder:"".concat(n.id),type:"textarea",onClick:function(t){e.clickStopper(t)},onBlur:function(t){e.frontendRenamer(t)},onKeyPress:function(t){return e.handleKeyPress(t)}}))),o.a.createElement("div",{className:"column conv-buttons-column",onClick:function(t){e.clickStopper(t)}},o.a.createElement("img",{onClick:function(t){e.buttonClick(t)},alt:"star",src:"./assets/".concat(t),id:"star",className:"star-button"}),o.a.createElement("button",{id:"open",onClick:function(t){e.openUp(t)},className:"open-button"},"Open"),o.a.createElement("button",{id:"delete",onClick:function(t){e.buttonClick(t)},className:"delete-button"},"Delete")))}))))}}]),n}(o.a.Component),f=n(14),g=n(34),b=n(35),k=n.n(b),C=new WebSocket("wss://ava-backend.herokuapp.com/"),E=new k.a.Connection(C);var y=function(t){Object(h.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(u.a)(this,n),(a=e.call(this,t)).handleInput=a.handleInput.bind(Object(f.a)(a)),a.textArea=o.a.createRef(),a}return Object(p.a)(n,[{key:"textEntered",value:function(){var t=Object(l.a)(i.a.mark((function t(e,n){var a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=JSON.stringify({text:e,file:n}),t.next=3,fetch("https://ava-backend.herokuapp.com/mutations",{headers:{Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:a,method:"POST"});case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"opHandler",value:function(t){var e,n=this,a=this.props.conversations.filter((function(t){return t.id===n.props.route}));Object.keys(t[0]).includes("si")?e="INSERTION @ ".concat(t[0].p,":  ").concat(t[0].si):Object.keys(t[0]).includes("sd")&&(e="DELETION @ ".concat(t[0].p,":  ").concat(t[0].sd)),this.setState({conversations:a[0].lastMutation=e});var o=JSON.stringify({mutation:e,file:a[0].id});fetch("https://ava-backend.herokuapp.com/mutations",{headers:{Accept:"application/json","Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:o,method:"PATCH"}),console.log(a[0].lastMutation,"IS THE LAST MUTATION")}},{key:"componentDidMount",value:function(){var t=this,e=c.a.findDOMNode(this.textArea.current),n=this.props.conversations.filter((function(e){return e.id===t.props.route}))[0].content,a=E.get("textPads","".concat(this.props.route,".json"));console.log("DOC:",a),E.fetchSnapshot("textPads","".concat(this.props.route,".json"),(function(t,e){console.log("SNAPSHOT:",e)})),a.on("op",(function(e){return t.opHandler(e)})),a.subscribe((function(t){if(t)throw t;!function(t,e,n){if(null===t.type)return console.log("File does not exist. Creating a blank."),t.create("",n);console.log("File exists. Populating with:",e),n()}(a,n,(function(){})),new g(e,a).setup()}))}},{key:"starClick",value:function(t){var e=t.target.parentElement.textContent;this.props.starToggler(e)}},{key:"handleInput",value:function(t){var e=t.target.parentElement.parentElement.firstChild.firstChild.textContent;this.textEntered(t.target.value,e)}},{key:"render",value:function(){var t,e,n=this,a=this.props,r=a.route,c=a.conversations.filter((function(t){return t.id===r})),s=c[0].lastMutation;return s&&(s.includes("INSERTION")?t="#4bcc14":s.includes("DELETION")&&(t="#fc845f")),e=localStorage.getItem("".concat(c[0].id,"-star"))?localStorage.getItem("".concat(c[0].id,"-star")):"star.svg",o.a.createElement("div",{className:"container conv-container"},o.a.createElement("div",{className:"row conv-input-ops-row"},o.a.createElement("div",{className:"column conv-input-ops-column"},o.a.createElement("button",{onClick:function(t){n.props.onRouteChange("home")},id:"new",className:"home-button"}," \u2190Home"))),o.a.createElement("div",{className:"column conv-column"},o.a.createElement("div",{className:"row conv-label-row"},o.a.createElement("div",{className:"column conv-label-column"},o.a.createElement("img",{onClick:function(t){n.starClick(t)},alt:"star",src:"./assets/".concat(e),id:"star",className:"star-button"}),o.a.createElement("p",null,"".concat(c[0].id))),o.a.createElement("div",{className:"column conv-last-mutation-column"},o.a.createElement("p",{className:"last-mutation"},o.a.createElement("span",{style:{color:"".concat(t)}},s)))),o.a.createElement("div",{className:"conv-border"}),o.a.createElement("div",{className:"row conv-row"},o.a.createElement("textarea",{ref:this.textArea,doc:this.doc,defaultValue:c[0].content,onBlur:this.handleInput,className:"conv-input"}))))}}]),n}(o.a.Component),w=n(36),O=n.n(w),N=(n(79),function(t){Object(h.a)(n,t);var e=Object(d.a)(n);function n(){var t;return Object(u.a)(this,n),(t=e.call(this)).onRouteChange=function(e){return"home"===e&&t.handleUpdate(),t.setState({route:e})},t.starToggler=function(e){var n,a=t.state.conversations.filter((function(t){return t.id===e}));return console.log(a),"star-filled.svg"===localStorage.getItem("".concat(a[0].id,"-star"))?(console.log("false"),n="star.svg"):(console.log("true"),n="star-filled.svg"),localStorage.setItem("".concat(a[0].id,"-star"),"".concat(n)),t.setState({conversations:t.state.conversations})},t.state={conversations:[],route:"home",lastMutation:[]},t}return Object(p.a)(n,[{key:"getConversations",value:function(){var t=Object(l.a)(i.a.mark((function t(){var e=this;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({conversations:[],lastMutation:[]}),t.prev=1,t.next=4,O.a.get("https://ava-backend.herokuapp.com/conversations");case 4:t.sent.data.forEach((function(t){return e.setState({conversations:e.state.conversations.concat(t)})})),t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(1),t.abrupt("return",console.log(t.t0));case 11:case"end":return t.stop()}}),t,this,[[1,8]])})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.getConversations()}},{key:"handleUpdate",value:function(){this.getConversations()}},{key:"render",value:function(){var t=this.state.route;return o.a.createElement("div",{className:"App"},o.a.createElement("header",{className:"App-header"},o.a.createElement("h1",null,"The Collabatron"),"home"===t?o.a.createElement(v,Object.assign({},this.state,{buttonClick:this.buttonClick,starToggler:this.starToggler,onRouteChange:this.onRouteChange,getConversations:this.getConversations})):o.a.createElement(y,Object.assign({},this.state,{starToggler:this.starToggler,buttonClick:this.buttonClick,onRouteChange:this.onRouteChange,opHandler:this.opHandler}))))}}]),n}(o.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(N,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[37,1,2]]]);
//# sourceMappingURL=main.95afb9a5.chunk.js.map